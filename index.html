<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Jarvis - Sosyal Medya Odaları</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { background: #0a0a0a; color: #00ffcc; font-family: 'Courier New', monospace; text-align: center; }
        .container { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; padding: 20px; }
        .room { border: 2px solid #00ffcc; padding: 20px; width: 200px; border-radius: 10px; cursor: pointer; transition: 0.3s; }
        .room:hover { background: #00ffcc; color: #0a0a0a; }
        .input-group { margin-top: 20px; }
        input { padding: 10px; border-radius: 5px; border: none; width: 250px; margin: 5px; }
        button { padding: 10px 20px; background: #00ffcc; color: #000; border: none; cursor: pointer; font-weight: bold; }
        #auth-section { margin-bottom: 30px; border-bottom: 1px solid #333; padding-bottom: 20px; }
    </style>
</head>
<body>

    <div id="auth-section">
        <h2>JARVIS GİRİŞ SİSTEMİ</h2>
        <button onclick="login()">Google ile Giriş Yap</button>
        <button onclick="logout()">Çıkış Yap</button>
        <p id="user-status">Durum: Giriş yapılmadı</p>
    </div>

    <div class="container">
        <div class="room" onclick="selectRoom('TikTok')">TIKTOK ODASI</div>
        <div class="room" onclick="selectRoom('Instagram')">INSTAGRAM ODASI</div>
        <div class="room" onclick="selectRoom('YouTube')">YOUTUBE ODASI</div>
        <div class="room" onclick="selectRoom('X / Twitter')">X ODASI</div>
    </div>

    <div class="input-group">
        <h3 id="selected-room-name">Lütfen Oda Seçin</h3>
        <input type="text" id="title" placeholder="Başlık Yazın..."><br>
        <input type="text" id="hashtag" placeholder="#Hashtag Yazın..."><br>
        <button onclick="paylas()">PAYLAŞ</button>
    </div>

    <script>
        // SUPABASE BAĞLANTISI
        const _supabase = supabase.createClient("BURAYA_PROJECT_URL", "BURAYA_PUBLISHABLE_KEY");

        let seciliOda = "";

        // ODA SEÇİMİ
        function selectRoom(roomName) {
            seciliOda = roomName;
            document.getElementById('selected-room-name').innerText = "Seçili Oda: " + roomName;
        }

        // GOOGLE GİRİŞ
        async function login() {
            await _supabase.auth.signInWithOAuth({ provider: 'google' });
        }

        async function logout() {
            await _supabase.auth.signOut();
            location.reload();
        }

        // GİRİŞ DURUMU KONTROLÜ
        _supabase.auth.onAuthStateChange((event, session) => {
            if (session) {
                document.getElementById('user-status').innerText = "Hoş geldin: " + session.user.email;
            }
        });

        // PAYLAŞ BUTONU (SENİN İSTEDİĞİN KISITLAMALAR BURADA)
        async function paylas() {
            // 1. KONTROL: Üye Girişi
            const { data: { session } } = await _supabase.auth.getSession();
            if (!session) {
                alert("HATA: İşlem yapmak için önce giriş yapmalısınız!");
                return;
            }

            if (seciliOda === "") {
                alert("Lütfen bir oda seçin!");
                return;
            }

            const baslik = document.getElementById('title').value;
            const hashtag = document.getElementById('hashtag').value;

            // 2. KONTROL: 100 Karakter Sınırı
            if ((baslik.length + hashtag.length) > 100) {
                alert("HATA: Başlık ve Hashtag toplamı 100 karakteri geçemez!");
                return;
            }

            // HER ŞEY TAMAMSA VERİTABANINA KAYDET
            const { error } = await _supabase.from('paylasimlar').insert([
                { 
                    oda: seciliOda, 
                    baslik: baslik, 
                    hashtag: hashtag, 
                    user_email: session.user.email 
                }
            ]);

            if (!error) {
                alert("Başarıyla Paylaşıldı!");
            } else {
                alert("Bir hata oluştu: " + error.message);
            }
        }
    </script>
</body>
</html>
